<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Archive | Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
        :root {
            --bg-dark: #020617;
            --text-primary: #E2E8F0;
            --text-secondary: #94A3B8;
            --accent-cyan: #0e7490; /* 더 어두운 시안 */
            --accent-blue-deep: #00145d57; /* 더 어두운 짙은 파랑 (Navy) */
            --accent-blue-sky: #00203272;  /* 더 어두운 하늘색 (Dark Sky) */
            --card-bg: rgba(15, 23, 42, 0.65); /* 가독성을 위해 카드 배경을 약간 더 불투명하게 조정 */
            --card-border: rgba(255, 255, 255, 0.1);
            --glow-color: rgba(34, 211, 238, 0.4);
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            position: relative;
            overflow-x: hidden;
        }

        /* --- Animated Gradient Shapes Background --- */
        .background-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.5; /* 선명도를 높인 대신 투명도를 약간 낮춰 조화롭게 만듭니다. */
            mix-blend-mode: screen; /* 색상 혼합 효과 */
            filter: blur(70px); /* 블러 값을 줄여 도형을 훨씬 더 선명하게 만듭니다. */
            will-change: transform;
        }

        .shape-1 {
            width: 40vmax;
            height: 40vmax;
            background-color: var(--accent-cyan);
            top: -10vh;
            left: -10vw;
            animation: move-shape-1 25s infinite alternate ease-in-out;
        }

        .shape-2 {
            width: 50vmax;
            height: 50vmax;
            background-color: var(--accent-blue-deep);
            bottom: -20vh;
            right: -15vw;
            animation: move-shape-2 30s infinite alternate ease-in-out -8s;
        }

        .shape-3 {
            width: 35vmax;
            height: 35vmax;
            background-color: var(--accent-blue-sky);
            bottom: 25vh;
            left: 5vw;
            animation: move-shape-3 22s infinite alternate ease-in-out -15s;
        }

        @keyframes move-shape-1 {
            from { transform: translate(0, 0) rotate(0deg) scale(1.1); }
            to { transform: translate(15vw, 10vh) rotate(45deg) scale(1); }
        }
        @keyframes move-shape-2 {
            from { transform: translate(0, 0) rotate(0deg) scale(1); }
            to { transform: translate(-20vw, -15vh) rotate(-30deg) scale(1.2); }
        }
        @keyframes move-shape-3 {
            from { transform: translate(0, 0) rotate(0deg) scale(0.9); }
            to { transform: translate(10vw, -5vh) rotate(60deg) scale(1.1); }
        }

        /* --- Glassmorphism Card Style --- */
        .glass-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(20px); /* 배경 도형이 더 잘 보이도록 블러 반경 미세 조정 */
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .glass-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 0 40px -10px var(--glow-color), 0 10px 15px -3px rgba(0,0,0,0.2);
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            transition: all 0.2s ease-in-out;
        }
        .glass-input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 15px var(--glow-color);
            background: rgba(255, 255, 255, 0.08);
        }
    </style>
</head>
<body class="antialiased">

    <div class="background-shapes" aria-hidden="true">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>

    <div class="relative z-10 min-h-screen p-4 sm:p-6 lg:p-8">
        <header class="flex justify-between items-center mb-12 md:mb-16 max-w-7xl mx-auto">
            <h1 class="text-3xl md:text-4xl font-black tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">BOARD</h1>
            <a href="/#board" class="text-sm font-bold transition-all duration-300 hover:text-white flex items-center gap-2 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:border-cyan-400 hover:bg-cyan-500/10">
                <i class="fa-solid fa-arrow-left"></i>
                <span class="hidden md:inline">Back to Main</span>
            </a>
        </header>

        <div class="max-w-7xl mx-auto lg:grid lg:grid-cols-3 lg:gap-8">
            <aside class="lg:col-span-1 lg:sticky lg:top-8 h-fit">
                 <section id="add-article-section" class="mb-8 lg:mb-0">
                    <div class="glass-card rounded-2xl p-6">
                        <h2 class="text-xl font-bold mb-5 flex items-center gap-3"><i class="fa-solid fa-pen-nib text-cyan-400"></i> 새로운 글 작성</h2>
                        <form id="add-article-form" class="space-y-4">
                            <div>
                                <label for="title" class="block text-sm font-medium text-text-secondary mb-1.5">제목</label>
                                <input type="text" id="title" name="title" required class="glass-input w-full rounded-lg px-4 py-2.5 text-white placeholder:text-slate-500">
                            </div>
                            <div>
                                <label for="content" class="block text-sm font-medium text-text-secondary mb-1.5">내용</label>
                                <textarea id="content" name="content" rows="6" required class="glass-input w-full rounded-lg px-4 py-2.5 text-white placeholder:text-slate-500"></textarea>
                            </div>
                            <div class="pt-2">
                                <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 hover:shadow-[0_0_20px_var(--glow-color)] hover:scale-105">
                                    <i class="fa-solid fa-plus mr-2"></i> 글 추가하기
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
            </aside>

            <main class="lg:col-span-2">
                <section id="article-list-section">
                    <div id="article-list" class="space-y-6">
                        <div id="no-articles-message" th:if="${articles.isEmpty()}" class="glass-card rounded-2xl p-8 text-center">
                            <p class="text-text-secondary">아직 게시된 글이 없습니다. 첫 번째 글을 작성해보세요.</p>
                        </div>
                        
                        <article th:each="article : ${articles}" th:id="'article-' + ${article.id}" class="glass-card rounded-2xl p-6 md:p-8">
                            <h2 class="text-2xl font-bold mb-3" th:text="${article.title}"></h2>
                            <p class="text-text-secondary leading-relaxed mb-6 whitespace-pre-wrap" th:text="${article.content}"></p>
                            <div class="flex justify-end items-center gap-3 pt-4 border-t border-white/10">
                                <!-- 수정 버튼: 이제 '수정' 페이지로 이동하는 링크(<a>) 역할을 합니다. -->
                                <a th:href="@{/article_edit/{id}(id=${article.id})}" class="text-sm text-cyan-300 bg-cyan-500/10 hover:bg-cyan-500/20 border border-cyan-500/20 hover:border-cyan-500/40 rounded-lg px-4 py-2 font-semibold transition-colors flex items-center gap-2"><i class="fa-solid fa-pen"></i> 수정</a>
                                <button th:data-id="${article.id}" class="delete-btn text-sm text-red-400 bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 hover:border-red-500/40 rounded-lg px-4 py-2 font-semibold transition-colors flex items-center gap-2"><i class="fa-solid fa-trash"></i> 삭제</button>
                            </div>
                        </article>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- 수정 기능이 별도 페이지로 분리되었으므로, 모달과 관련 스크립트는 제거되었습니다. -->
    
    <script>
    // 페이지가 로드되면 실행될 스크립트
    document.addEventListener('DOMContentLoaded', () => {
        // 새 글 추가 폼 처리
        const addArticleForm = document.getElementById('add-article-form');
        if (addArticleForm) {
            addArticleForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(addArticleForm);
                const response = await fetch('/api/articles', {
                    method: 'POST',
                    body: new URLSearchParams(formData)
                });
                if (response.ok) {
                    window.location.reload(); // 성공 시 페이지 새로고침
                } else {
                    alert('게시글 추가에 실패했습니다.');
                }
            });
        }

        // 게시글 목록에서의 이벤트 처리 (삭제 버튼)
        const articleList = document.getElementById('article-list');
        if (articleList) {
            articleList.addEventListener('click', async (e) => {
                const target = e.target.closest('.delete-btn');
                if (!target) return;

                const articleId = target.dataset.id;
                if (confirm('정말로 이 게시글을 삭제하시겠습니까?')) {
                    const response = await fetch(`/api/articles/${articleId}`, { method: 'DELETE' });
                    if (response.ok) {
                        const articleElement = document.getElementById(`article-${articleId}`);
                        articleElement.style.transition = 'opacity 0.5s, transform 0.5s';
                        articleElement.style.opacity = '0';
                        articleElement.style.transform = 'translateX(-20px)';
                        setTimeout(() => articleElement.remove(), 500);
                    } else {
                        alert('삭제에 실패했습니다.');
                    }
                }
            });
        }
    });
    </script>
</body>
</html>
